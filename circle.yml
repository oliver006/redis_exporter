machine:
  services:
    - redis
  environment:
    PKG: github.com/oliver006/redis_exporter

test:
  pre:
    - env GOPATH=$PWD:$PWD/vendor go vet $PKG/...
    - go get -u github.com/mattn/goveralls
    - go get -u golang.org/x/tools/cmd/cover
    - go get -u github.com/constabulary/gb/...
    - gb vendor restore
  override:
    - env GOPATH=$PWD:$PWD/vendor go test -v -cover -race -coverprofile=$CIRCLE_ARTIFACTS/coverage.out $PKG/exporter
  post:
    - env GOPATH=$PWD:$PWD/vendor goveralls -coverprofile=$CIRCLE_ARTIFACTS/coverage.out -service=circle-ci -repotoken=$COVERALLS_REPO_TOKEN
